@model List<Admin.Models.Products>
@{
    ViewData["Title"] = "Shop All Bouquets - Java Florist";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var categories = ViewBag.Categories as List<Admin.Models.Category> ?? new List<Admin.Models.Category>();
}

<style>
    /* Shop Hero Section */
    .shop-hero {
        background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('/images/shopbanner.jpg');
        background-size: cover;
        background-position: center;
        color: white;
        text-align: center;
        padding: 200px 20px;
        margin-bottom: 40px;
    }

        .shop-hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 48px;
            margin-bottom: 20px;
        }

        .shop-hero p {
            font-size: 20px;
            max-width: 700px;
            margin: 0 auto;
        }

    /* Shop Controls */
    .shop-controls {
        background: #FFDAB9;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 40px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }

    .controls-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
    }

    .search-box {
        flex: 1;
        min-width: 300px;
    }

        .search-box input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #C1E1C1;
            border-radius: 25px;
            font-size: 16px;
        }

    .filter-section {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }

    .filter-select {
        padding: 12px 20px;
        border: 2px solid #C1E1C1;
        border-radius: 25px;
        background: white;
        font-size: 16px;
        cursor: pointer;
    }

    /* Products Grid */
    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 30px;
        margin-bottom: 60px;
    }

    .product-card {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        position: relative;
    }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

    .product-badge {
        position: absolute;
        top: 15px;
        left: 15px;
        background: #05a005;
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        z-index: 2;
    }

    .product-image {
        width: 100%;
        height: 250px;
        object-fit: cover;
        border-bottom: 3px solid #FFDAB9;
    }

    .product-content {
        padding: 20px;
    }

    .product-category {
        color: #666;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 5px;
    }

    .product-title {
        font-family: 'Playfair Display', serif;
        font-size: 20px;
        margin-bottom: 10px;
        color: #000;
    }

    .product-description {
        color: #666;
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 15px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .product-price {
        font-size: 22px;
        font-weight: bold;
        color: #05a005;
        margin-bottom: 15px;
    }

    .product-actions {
        display: flex;
        gap: 10px;
    }

    .btn-view {
        flex: 2;
        background: #FFDAB9;
        color: #000;
        border: none;
        padding: 10px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        text-align: center;
    }

        .btn-view:hover {
            background: #C1E1C1;
            transform: translateY(-2px);
        }

    .btn-cart {
        flex: 1;
        background: #C1E1C1;
        color: #000;
        border: none;
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
    }

        .btn-cart:hover {
            background: #FFDAB9;
            transform: translateY(-2px);
        }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 80px 20px;
        color: #666;
    }

        .empty-state i {
            font-size: 80px;
            margin-bottom: 20px;
            color: #FFDAB9;
        }

        .empty-state h3 {
            font-family: 'Playfair Display', serif;
            margin-bottom: 15px;
            color: #000;
        }

    /* Categories Section */
    .categories-section {
        margin-bottom: 60px;
    }

    .section-title {
        text-align: center;
        font-family: 'Playfair Display', serif;
        font-size: 36px;
        margin-bottom: 40px;
        color: #333;
        position: relative;
    }

        .section-title::after {
            content: "";
            display: block;
            width: 80px;
            height: 4px;
            background: #05a005;
            margin: 12px auto 0;
            border-radius: 2px;
        }

    .categories-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
    }

    .category-card {
        background: #FFDAB9;
        padding: 30px 20px;
        border-radius: 15px;
        text-align: center;
        text-decoration: none;
        color: #000;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

        .category-card:hover {
            background: #C1E1C1;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-decoration: none;
            color: #000;
        }

    .category-icon {
        font-size: 40px;
        margin-bottom: 15px;
    }

    .category-name {
        font-family: 'Playfair Display', serif;
        font-size: 18px;
        font-weight: 600;
    }

    /* Responsive Design */
    @@media (max-width: 768px) {
        .shop-hero h1 {
            font-size: 36px;
        }

        .shop-hero p {
            font-size: 18px;
        }

        .controls-row {
            flex-direction: column;
            align-items: stretch;
        }

        .search-box {
            min-width: 100%;
        }

        .filter-section {
            justify-content: center;
        }

        .products-grid {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .categories-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @@media (max-width: 480px) {
        .products-grid {
            grid-template-columns: 1fr;
        }

        .categories-grid {
            grid-template-columns: 1fr;
        }

        .product-actions {
            flex-direction: column;
        }
    }
</style>

<!-- Hero Section -->
<section class="shop-hero">
    <div class="container">
        <h1>Beautiful Bouquets 🌸</h1>
        <p>Discover our exquisite collection of handcrafted floral arrangements for every occasion</p>
    </div>
</section>

<!-- Shop Controls -->
<section class="container">
    <div class="shop-controls">
        <div class="controls-row">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search bouquets... 🌹">
            </div>
            <div class="filter-section">
                <select class="filter-select" id="categoryFilter">
                    <option value="">All Categories</option>
                    @foreach (var category in categories)
                    {
                        <option value="@category.CategoryName">@category.CategoryName</option>
                    }
                </select>
                <select class="filter-select" id="priceFilter">
                    <option value="">All Prices</option>
                    <option value="0-50">Under Rs 50</option>
                    <option value="50-100">Rs 50 - Rs 100</option>
                    <option value="100-200">Rs 100 - Rs 200</option>
                    <option value="200-999">Rs 200+</option>
                </select>
                <select class="filter-select" id="sortFilter">
                    <option value="name">Sort by Name</option>
                    <option value="price-low">Price: Low to High</option>
                    <option value="price-high">Price: High to Low</option>
                    <option value="newest">Newest First</option>
                </select>
            </div>
        </div>
    </div>
</section>

<!-- Products Grid -->
<section class="container">
    @if (Model != null && Model.Any())
    {
        <div class="products-grid" id="productsGrid">
            @foreach (var product in Model)
            {
                <div class="product-card" data-category="@product.Pro_category" data-price="@product.Pro_price" data-name="@product.Pro_name.ToLower()">
                    @if (product.Pro_price < 50)
                    {
                        <div class="product-badge">Great Value</div>
                    }
                    else if (product.Pro_price > 100)
                    {
                        <div class="product-badge">Premium</div>
                    }

                    <!-- ✅ FIXED: SAME CODE AS BIRTHDAY PAGE -->
                    <img src="~/Content/Images/@product.Pro_imagename"
                         alt="@product.Pro_name"
                         class="product-image"
                         onerror="this.src='https://via.placeholder.com/400x300/FFDAB9/C1E1C1?text=@Uri.EscapeDataString(product.Pro_name)'">

                    <div class="product-content">
                        <div class="product-category">@product.Pro_category</div>
                        <h3 class="product-title">@product.Pro_name</h3>
                        <p class="product-description">@product.Pro_des</p>
                        <!-- ✅ FIXED: Changed $ to Rs -->
                        <div class="product-price">Rs @product.Pro_price</div>
                        <div class="product-actions">
                            <a href="@Url.Action("ProductDetails", "Home", new { id = product.Pro_id })" class="btn-view">
                                View Details
                            </a>

                            <!-- ✅ FIXED CART BUTTON -->
                            @using (Html.BeginForm("AddToCart", "Cart", FormMethod.Post, new { @class = "d-inline" }))
                            {
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="productId" value="@product.Pro_id" />
                                <input type="hidden" name="quantity" value="1" />
                                <button type="submit" class="btn-cart" title="Add to Cart">
                                    🛒
                                </button>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="empty-state">
            <div>🌸</div>
            <h3>No Products Available</h3>
            <p>We're currently preparing our beautiful flower collection. Please check back soon!</p>
            <a href="@Url.Action("Index", "Home")" class="btn-view" style="display: inline-block; padding: 12px 30px; margin-top: 20px;">
                Back to Home
            </a>
        </div>
    }
</section>

@section Scripts {
    <script>
        // Search and Filter Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const categoryFilter = document.getElementById('categoryFilter');
            const priceFilter = document.getElementById('priceFilter');
            const sortFilter = document.getElementById('sortFilter');
            const productCards = document.querySelectorAll('.product-card');

            function filterProducts() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedCategory = categoryFilter.value;
                const selectedPrice = priceFilter.value;
                const sortBy = sortFilter.value;

                let visibleProducts = [];

                productCards.forEach(card => {
                    const productName = card.getAttribute('data-name');
                    const productCategory = card.getAttribute('data-category');
                    const productPrice = parseFloat(card.getAttribute('data-price'));

                    // Search filter
                    const matchesSearch = productName.includes(searchTerm);

                    // Category filter
                    const matchesCategory = !selectedCategory || productCategory === selectedCategory;

                    // Price filter
                    let matchesPrice = true;
                    if (selectedPrice) {
                        const [min, max] = selectedPrice.split('-').map(Number);
                        matchesPrice = productPrice >= min && productPrice <= max;
                    }

                    if (matchesSearch && matchesCategory && matchesPrice) {
                        card.style.display = 'block';
                        visibleProducts.push(card);
                    } else {
                        card.style.display = 'none';
                    }
                });

                // Sort products
                sortProducts(visibleProducts, sortBy);
            }

            function sortProducts(products, sortBy) {
                const productsGrid = document.getElementById('productsGrid');
                const sortedProducts = [...products];

                switch (sortBy) {
                    case 'price-low':
                        sortedProducts.sort((a, b) => parseFloat(a.getAttribute('data-price')) - parseFloat(b.getAttribute('data-price')));
                        break;
                    case 'price-high':
                        sortedProducts.sort((a, b) => parseFloat(b.getAttribute('data-price')) - parseFloat(a.getAttribute('data-price')));
                        break;
                    case 'name':
                        sortedProducts.sort((a, b) => a.getAttribute('data-name').localeCompare(b.getAttribute('data-name')));
                        break;
                    case 'newest':
                        // Default order (as in HTML)
                        break;
                }

                // Reorder products in grid
                sortedProducts.forEach(product => {
                    productsGrid.appendChild(product);
                });
            }

            // Event listeners
            searchInput.addEventListener('input', filterProducts);
            categoryFilter.addEventListener('change', filterProducts);
            priceFilter.addEventListener('change', filterProducts);
            sortFilter.addEventListener('change', filterProducts);

            // Add to Cart animation
            document.querySelectorAll('.btn-cart').forEach(button => {
                button.addEventListener('click', function(e) {
                    const form = this.closest('form');
                    if (!form) return;

                    // Store original content
                    const originalHTML = this.innerHTML;
                    const originalBackground = this.style.background;

                    // Add animation
                    this.innerHTML = '✓';
                    this.style.background = '#05a005';
                    this.style.color = 'white';

                    // Restore original appearance after 2 seconds
                    setTimeout(() => {
                        this.innerHTML = originalHTML;
                        this.style.background = originalBackground;
                        this.style.color = '#000';
                    }, 2000);
                });
            });
        });
    </script>
}